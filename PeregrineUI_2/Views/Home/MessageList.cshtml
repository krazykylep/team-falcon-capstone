@*
Author   : Chinh T Cao        
Version  : 1.0.0
Date     : 1/11/2012
Copyright: Capstone Project Team Falcon 2011 All right reserved
*@

@model PeregrineUI_2.Models.PageData<PeregrineUI_2.Models.Msg_inq>

<style type="text/css">       
        @@import url(../../Content/Table.css);         
</style>

<script type="text/javascript">

    /**/
    function Msg_inquiry_sorting(chkboxname) {
        // Getting the state of the chose checkbox
        var state = document.getElementById(chkboxname).checked;

        // If we check this checkbox, turnoff the other sorting checkbox
        if (state) {
            // Make ajax call to controller to update the table
            if (chkboxname == "Process_ID_Sort")
                Msg_inquiry_collect_info(   "1",
                                            "1",
                                            document.getElementById("process_prio_input").value,
                                            document.getElementById("process_name_input").value );
            else if (chkboxname == "Process_Name_Sort")
                Msg_inquiry_collect_info(   "1",
                                            "2",
                                            document.getElementById("process_prio_input").value,
                                            document.getElementById("process_name_input").value );
            else if (chkboxname == "Msg_Context_Sort")
                Msg_inquiry_collect_info(   "1",
                                            "3",
                                            document.getElementById("process_prio_input").value,
                                            document.getElementById("process_name_input").value );
            else if (chkboxname == "Msg_Priority_Sort")
                Msg_inquiry_collect_info(   "1",
                                            "4",
                                            document.getElementById("process_prio_input").value,
                                            document.getElementById("process_name_input").value );
            else if (chkboxname == "Msg_Date_Sort")
                Msg_inquiry_collect_info(   "1",
                                            "5",
                                            document.getElementById("process_prio_input").value,
                                            document.getElementById("process_name_input").value );
            else
                alert("SORTING ERROR");
        }
        else {
            // We are not allowed all sorting checkbox uncheck
            document.getElementById(chkboxname).checked = true;
        }
    }

</script>

<!-- Hidden labels to keep track of values -->
<label id="msg_inquiry_current_page" hidden="true">@Model.CurrentPage</label>
<label id="msg_inquiry_current_sort" hidden="true">@Model.SortingType</label>

<table id ="msg_list_table" class="display">
        <thead>
            <tr>
                <td>
                    Process ID 
                    @if (Model.SortingType == 1)
                    {
                        <input id="Process_ID_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)" checked="checked"/>
                    }
                    else
                    {
                        <input id="Process_ID_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)"/>
                    }              
                </td>
                <td>
                    Process Name 
                    @if (Model.SortingType == 2)
                    {
                        <input id="Process_Name_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)" checked="checked"/>
                    }
                    else
                    {
                        <input id="Process_Name_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)"/>
                    }   
                </td>
                <td>
                    Message Context 
                    @if (Model.SortingType == 3)
                    {
                        <input id="Msg_Context_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)" checked="checked"/>
                    }
                    else
                    {
                        <input id="Msg_Context_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)"/>
                    }   
                </td>
                <td>
                    Priority 
                    @if (Model.SortingType == 4)
                    {
                        <input id="Msg_Priority_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)" checked="checked"/>
                    }
                    else
                    {
                        <input id="Msg_Priority_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)"/>
                    }   
                </td>
                <td>
                    Message Type
                </td>
                <td>
                    Date 
                    @if (Model.SortingType == 5)
                    {
                        <input id="Msg_Date_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)" checked="checked"/>
                    }
                    else
                    {
                        <input id="Msg_Date_Sort" type="checkbox" onclick="Msg_inquiry_sorting(this.id)"/>
                    }   
                </td>
            </tr>
        </thead>     
        <tbody>
            @foreach (var message in Model.Data)
            {
                <tr>
                    <td>@message.ProcessID.ToString() </td>
                    <td>@message.ProcessName </td>
                    <td>@message.Content </td>
                    <td>@message.Priority.ToString() </td>
                    <td>@message.MsgType </td>
                    <td>@message.Date.ToString("yyyy-MM-dd HH:mm tt") 
                        <br /> ( : 
                        @( ((int)(DateTime.Now.Subtract(message.Date).TotalMinutes)).ToString() ) minutes )
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4">
                    @{  // Pagination     

                        int start, end;

                        // Get the value of start and end based on the value of currpage and total number of page
                        if (Model.NumberOfPages <= 5)
                        {
                            // If the total number of page is less than 5, show all to user
                            start = 0;
                            end = Model.NumberOfPages;
                        }
                        else
                        {
                            // Else, allows user to choose first page, last page and 5 other page around current chose page
                            start = Model.CurrentPage - 2;
                            end = Model.CurrentPage + 2;

                            if (start < 1)
                            {
                                start = 1;
                                end = 5;
                            }
                            else if (end > Model.NumberOfPages)
                            {
                                start = Model.NumberOfPages - 4;
                                end = Model.NumberOfPages;
                            }
                        }

                        for (int i = 1; i <= Model.NumberOfPages; i++)
                        {
                            if (i < start)
                            {
                                if (i == 1)
                                {
                                    <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>   
                                }
                                else
                                {
                                    <label>...</label>
                                    i = start - 1;
                                }
                            }
                            else if (i > end)
                            {
                                if (i == Model.NumberOfPages)
                                {
                                    <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>
                                }
                                else
                                {
                                    <label>...</label>
                                    i = Model.NumberOfPages - 1;
                                }
                            }
                            else if (i == Model.CurrentPage)
                            {
                                @i
                            }
                            else
                            {
                                <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>
                            }
                        }    
                                                               
                    }
                            
                    <label>|</label>
                    <label>Go to page:</label> 
                    <input  id="msg_inquiry_page_number" type="text" style="width: 40px" 
                            onchange="Msg_inquiry_collect_info  (     
                                                                    document.getElementById(this.id).value,
                                                                    document.getElementById('msg_inquiry_current_sort').innerHTML,
                                                                    document.getElementById('process_prio_input').value,
                                                                    document.getElementById('process_name_input').value     
                                                                )" />
                                                                                                                                                                        
                </td>
            </tr>
        </tfoot>
</table>