@*
Author   : Chinh T Cao        
Version  : 1.0.0
Date     : 1/11/2012
Copyright: Capstone Project Team Falcon 2011 All right reserved
*@

@model PeregrineUI_2.Models.PageData<PeregrineUI_2.Models.Message>

<script type="text/javascript">
   
    /**/
    // Update page and sort val
    $(document).ready(function () {   
        msg_inquiry_current_page = @(Model.CurrentPage);
        msg_inquiry_current_sort = @(Model.SortingType);
    });
    
    
    function GoToMainPage( processName) {
        window.location.href = "Index";
        MainPageAjaxUpdate(1, 1, processName)
    }

</script>                          

<table id ="msg_list_table" class="display">
        <thead>
            <tr>            
                <td>                                         
                    <div style="float: left">Message ID</div> 
                    <div style="float: right">           
                        

                        <div id="Msg_inq_msg_id_sort_acc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="up_arrow @if(Model.SortingType == 0){
                                                                                                                                          @:arrow_selected
                                                                                                                                          }"></div></div>
                        <div id="Msg_inq_msg_id_sort_desc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="down_arrow @if(Model.SortingType == 1){
                                                                                                                                                 @:arrow_selected
                                                                                                                                              }"></div></div>
                    </div>                           
                </td>
                <td>     
                    <div style="float: left">Message Context</div> 
                    <div style="float: right">                         
                       

                        <div id="Msg_inq_context_sort_acc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="up_arrow @if(Model.SortingType == 2){
                                                                                                                                          @:arrow_selected
                                                                                                                                          }"></div></div>
                        <div id="Msg_inq_context_sort_desc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="down_arrow @if(Model.SortingType == 3){
                                                                                                                                                 @:arrow_selected
                                                                                                                                              }"></div></div>                     
                    </div> 
                </td>
                <td>       
                    <div style="float: left">Process Name</div>  
                    <div style="float: right">                         
                       

                        <div id="Msg_inq_name_sort_acc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="up_arrow @if(Model.SortingType == 4){
                                                                                                                                          @:arrow_selected
                                                                                                                                          }"></div></div>
                        <div id="Msg_inq_name_sort_desc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="down_arrow @if(Model.SortingType == 5){
                                                                                                                                                 @:arrow_selected
                                                                                                                                              }"></div></div>                                   
                    </div> 
                </td>           
                <td>
                    <div style="float: left">Priority</div> 
                    <div style="float: right">   
                        
                        
                        <div id="Msg_inq_prio_sort_acc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="up_arrow @if(Model.SortingType == 6){
                                                                                                                                          @:arrow_selected
                                                                                                                                          }"></div></div>
                        <div id="Msg_inq_prio_sort_desc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="down_arrow @if(Model.SortingType == 7){
                                                                                                                                                 @:arrow_selected
                                                                                                                                              }"></div></div>
                    </div>
                </td>
                <td>
                    <div style="float: left">Message Type</div> 
                </td>
                <td> 
                    <div style="float: left">Date</div>  
                    <div style="float: right">                                     
                       

                        <div id="Msg_inq_date_sort_acc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="up_arrow @if(Model.SortingType == 8){
                                                                                                                                          @:arrow_selected
                                                                                                                                          }"></div></div>
                        <div id="Msg_inq_date_sort_desc" onclick="Msg_inquiry_sorting(this.id);" class="arrow_bg"><div class="down_arrow @if(Model.SortingType == 9){
                                                                                                                                                 @:arrow_selected
                                                                                                                                              }"></div></div>
                    </div> 
                </td>
            </tr>
        </thead>     
        <tbody>
            @foreach (var message in Model.Data)
            {
                <tr>
                    <td>    @message.MessageID.ToString() </td>                 
                    <td>
                            @message.Content
                            @if (message.Content.Length > 8)
                            {                      
                                <a id="@(message.Content)" href='' style="text-decoration:none" onclick='return showpopup(@(message.ProcessID), "@(message.ProcessName)", document.getElementById(this.id));'>...</a> 
                            }                                                              
                    </td>
                    <td id="@(message.ProcessName)" >
                            <div class="top" onmouseover="this.className='top2'" onmouseout="this.className='top'">
                            <img src="../../Content/images/@(message.ProcessState.Trim()).png" alt=""/>      
                            <a href="Index?Process=@message.ProcessName">@message.ProcessName</a>
                            </div>
                    </td>
                    <td>    @message.Priority.ToString() </td>
                    <td>    @message.MsgType </td>
                    <td>    @message.Date.ToString("yyyy-MM-dd HH:mm tt") 
                            <br /> ( : 
                            @( ((int)(DateTime.Now.Subtract(message.Date).TotalMinutes)).ToString()) minutes )
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <!--<td colspan="4">
                    @{  // Pagination     

                        int start, end;

                        // Get the value of start and end based on the value of currpage and total number of page
                        if (Model.NumberOfPages <= 5)
                        {
                            // If the total number of page is less than 5, show all to user
                            start = 0;
                            end = Model.NumberOfPages;
                        }
                        else
                        {
                            // Else, allows user to choose first page, last page and 5 other page around current chose page
                            start = Model.CurrentPage - 2;
                            end = Model.CurrentPage + 2;

                            if (start < 1)
                            {
                                start = 1;
                                end = 5;
                            }
                            else if (end > Model.NumberOfPages)
                            {
                                start = Model.NumberOfPages - 4;
                                end = Model.NumberOfPages;
                            }
                        }

                        for (int i = 1; i <= Model.NumberOfPages; i++)
                        {
                            if (i < start)
                            {
                                if (i == 1)
                                {
                                    <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>   
                                }
                                else
                                {
                                    <label>...</label>
                                    i = start - 1;
                                }
                            }
                            else if (i > end)
                            {
                                if (i == Model.NumberOfPages)
                                {
                                    <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>
                                }
                                else
                                {
                                    <label>...</label>
                                    i = Model.NumberOfPages - 1;
                                }
                            }
                            else if (i == Model.CurrentPage)
                            {
                                @i
                            }
                            else
                            {
                                <a class="msg_inquiry_page-number" href="javascript:void(0)">@i</a>
                            }
                        }    
                                                               
                    }
                            
                    <label>|</label>
                    <label>Go to page:</label> 
                    <input  id="msg_inquiry_page_number" type="text" style="width: 40px" 
                            onchange="Msg_inquiry_collect_info  (     
                                                                    document.getElementById(this.id).value,
                                                                    msg_inquiry_current_sort,
                                                                    document.getElementById('process_prio_input').value,
                                                                    document.getElementById('process_name_input').value     
                                                                );" />
                                                                                                                                                                        
                </td>-->
                <td colspan="6">
                    <div style="text-align: center;"><input type="button" class="ui_button" value="Load More" onclick="MsgInquiryUpdate((msg_inquiry_current_page+1), msg_inquiry_current_sort, document.getElementById('process_prio_input').value, document.getElementById('process_name_input').value, (document.getElementById('SU_SD_Checkbox').checked+0))" /></div>
                </td>
            </tr>
        </tfoot>
</table>